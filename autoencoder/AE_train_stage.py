from keras.callbacks import TensorBoard
from keras.callbacks import EarlyStopping, ReduceLROnPlateau
from keras.callbacks import TensorBoard

from autoencoder.AE_network import deepAE
from ftruck_etl_utils import load_fuel_truck_dag_data


def train_ftruck_ae(data, frac_train=0.75, epochs=300, batch_size=28,
                    num_hidden1 = 512,
                    num_hidden2 = 256,
                    encoding_dim = 9,
                    optimizer='adam'):
    '''
    Train an auto-encoder model given the DAG representation of driving trips,
    the dimension size is 27x27
    # option 1: rmsprop  binary_crossentropy 256 64 3
    # option 2: adam     binary_crossentropy 512 256 9
    :param data:
    :param frac_train:
    :param epochs:
    :param batch_size:
    :param num_hidden1:
    :param num_hidden2:
    :param encoding_dim:
    :return:
    '''
    # data = data  #27*27+   1024 256 5
    # data = data  #27*27+  512 64 5
    input_dim = data.shape[1]

    autoencoder, encoder = deepAE(input_dim, num_hidden1, num_hidden2, encoding_dim, optimizer)
    # checkpoint
    # filepath="./ftruck.weights.best.hdf5"
    # checkpoint= ModelCheckpoint(filepath, monitor='val_loss', verbose=0, save_best_only=True, mode='auto')
    es = EarlyStopping(monitor='val_loss', patience=10, verbose=0, mode='auto')
    reduceLR = ReduceLROnPlateau(monitor='val_loss', factor=0.1, patience=10, verbose=0, mode='auto', epsilon=1e-6, cooldown=0, min_lr=0)
    callbacks_list = [es, reduceLR,  TensorBoard(log_dir='E:/tmp/autoencoder')]
    autoencoder.fit(data, data,
                    epochs=epochs,
                    batch_size=batch_size,
                    shuffle=True,
                    validation_split=1-frac_train,
                    # validation_data=(x_test, x_test),
                    callbacks=callbacks_list, verbose=0)

    print(autoencoder.evaluate(data, data, verbose=0))

    # pred = autoencoder.predict(data.head(1))
    # print(pred)
    # print(np.sum(pred))
    # display(data.head(1))

    return autoencoder, encoder


def model_selection(data):
    for optimizer in ['rmsprop']: #'adam', 'adadelta',
        for encoding_dim in [3, 5, 7, 9]:
            for num_hidden2 in [28, 64, 128, 256]:  #
                for num_hidden1 in [128, 256, 512, 1024, 2048]:  #
                    if encoding_dim <= 7:
                        if num_hidden1 > num_hidden2:
                            print(optimizer, num_hidden1, num_hidden2, encoding_dim)
                            autoencoder, encoder = train_ftruck_ae(data, num_hidden1=num_hidden1, num_hidden2=num_hidden2,
                                                                   encoding_dim=encoding_dim, optimizer=optimizer)
                            # autoencoder.save('deepAE_ftruck_freq_dag.model')
                            # encoder.save('encoder_ftruck_freq_dag.model')


if __name__ == '__main__':
    data = load_fuel_truck_dag_data().iloc[:,1:]

    # model selection for transit graph (as a whole)
    # model_selection(data)

    num_states = 27
    feature_dim = num_states * num_states
    # model selection for transit frequency graph
    # print('model selection for transit frequency graph')
    # model_selection(data.iloc[:, :feature_dim])

    # model selection for transit duration graph
    print('model selection for transit duration graph')
    model_selection(data.iloc[:, feature_dim:])

    # data = load_fuel_truck_dag_data('D:/data/fueltruck/transformed/dag1/part-00000')
    # print(data.iloc[:,feature_dim+1:].shape)

    # autoencoder, encoder = train_ftruck_ae(data.iloc[:,1:feature_dim+1],num_hidden1=512, num_hidden2=128, encoding_dim=5)
    # autoencoder.save('deepAE_ftruck_freq_dag.model')
    # encoder.save('encoder_ftruck_freq_dag.model')

    # autoencoder, encoder = train_ftruck_ae(data.iloc[:,feature_dim+1:],num_hidden1=512, num_hidden2=256, encoding_dim=5)
    # autoencoder.save('deepAE_ftruck_time_dag.model')
    # encoder.save('encoder_ftruck_time_dag.model')

    # print(data.head(5))
    # encoded = encoder.predict(data.head(5))
    # plt.figure(figsize=(6, 6))
    # plt.scatter(x_train_encoded[:, 0], x_train_encoded[:, 1])
    # plt.show()
    # plt.hist(encoded, bins=10, alpha = 0.05)
    # plt.show()
    # plt.hist(x_train_encoded[:,1],bins=30, alpha = 0.5)
    # plt.show()
    # print(autoencoder.predict(x_test))
    # print(np.mean(x_train_encoded,axis=0))
    # print(np.std(x_train_encoded,axis=0))
    # print(x_test)

    # encoder = Model(Input(shape=(9*9*3,)), autoencoder.get_layer(name='encoder_output_layer'))
    # encoded = encoder.predict(x_train)
    # print(encoded)
    # plt.hist(encoded * 1000, 50)
    # plt.show()

    # loss: 1.5642
    # 123/123 [==============================] - 0s 381us/step - loss: nan - val_loss: 7.6028




# def train_tdrive_ae(input_dim = 9*9*2, frac_train=0.8, epochs=300, batch_size=8):
#     data = load_tdrive_data(input_dim)
#     data = data.sample(frac=1).reset_index(drop=True)
#
#     train_size = int(data.shape[0] * frac_train)
#     x_train = data[:train_size]
#     x_test = data[train_size:]
#
#     from keras.callbacks import TensorBoard
#     autoencoder, encoder = deepAE(input_dim, 128, 20)
#     # checkpoint
#     filepath="./weights.best.hdf5"
#     checkpoint= ModelCheckpoint(filepath, monitor='val_acc', verbose=1, save_best_only=True, mode='auto')
#     callbacks_list= [checkpoint]
#     autoencoder.fit(x_train, x_train,
#                     epochs=epochs,
#                     batch_size=batch_size,
#                     shuffle=True,
#                     validation_data=(x_test, x_test),
#                     callbacks=[TensorBoard(log_dir='E:/tmp/autoencoder')])  ##, verbose=0
#     autoencoder.save('deepAE_tdrive.model')
#     return data, autoencoder


# rmsprop loss=rmse
# 128 28 3
# [1.659713572578185, 2.8958898835563205, 0.07695598483484524]
# 256 28 3
# [1.6597178858353758, 2.89590654860938, 0.07829183487133841]
# 512 28 3
# [1.6597137888703, 2.895888751473369, 0.07693167421532757]
# 1024 28 3
# [1.6597248420612294, 2.895928012984158, 0.07735915766474695]
# 2048 28 3
# [1.6597181420422735, 2.8958956891227325, 0.07650107232897374]
# 128 64 3
# [1.6597237688604325, 2.8959092337099577, 0.07800031075525467]
# 256 64 3
# [1.6597196397277199, 2.895895043488783, 0.07638177487538733]
# 512 64 3
# [1.6597182183410888, 2.895903401409804, 0.07710041526525706]
# 1024 64 3
# [1.6597150224607287, 2.895892371152734, 0.07750340934510315]
# 2048 64 3
# [1.6597149365821091, 2.8958877577753355, 0.0768690898951996]
# 256 128 3
# [1.6597144097633638, 2.8958914978334307, 0.07659279497991975]
# 512 128 3
# [1.659717748059208, 2.895907195729961, 0.07667392923625797]
# 1024 128 3
# [1.6597213552367682, 2.895915906508172, 0.07767709540246517]
# 2048 128 3
# [1.6597265333228, 2.89593073409711, 0.07675762133977258]
# 512 256 3
# [1.6597140724837682, 2.895888429117763, 0.07669215538810152]
# 1024 256 3
# [1.6597145332178842, 2.895893489048604, 0.07721252183244143]
# 2048 256 3
# [1.659723982967455, 2.8959248060245457, 0.07677555968057569]
# 128 28 5
# [1.6597162762360294, 2.895898706562418, 0.07665793334433818]
# 256 28 5
# [1.6597179282748695, 2.8958978736897536, 0.07713912116902759]
# 512 28 5
# [1.6597248052863154, 2.895941348955927, 0.07889309115825019]
# 1024 28 5
# [1.6597146147199109, 2.8958917511503675, 0.07717429742296762]
# 2048 28 5
# [1.6597221650281921, 2.8959076921112015, 0.07797743305477821]
# 128 64 5
# [1.6597140708113074, 2.895887900607333, 0.07708302872317972]
# 256 64 5
# [1.6597184205870963, 2.8959098125864484, 0.07736779315779165]
# 512 64 5
# [1.6597193806052295, 2.895901457984718, 0.07747096232271913]
# 1024 64 5
# [1.6597214791270256, 2.895910891278812, 0.07655019111448529]
# 2048 64 5
# [1.6597226225327288, 2.8959143654861266, 0.07803580466140539]
# 256 128 5
# [1.659726063547143, 2.8959350760232265, 0.07571285678307602]
# 512 128 5
# [1.6597193400112096, 2.8958993012535963, 0.07721357613795549]
# 1024 128 5
# [1.6597208425602488, 2.8959065635654087, 0.07788675513054326]
# 2048 128 5
# [1.659723877871556, 2.895914994369836, 0.07663295637574594]
# 512 256 5
# [1.6597188785273698, 2.8959057818661997, 0.0764642454617499]
# 1024 256 5
# [1.6597183396105168, 2.895896296129886, 0.0772810353845623]
# 2048 256 5
# [1.6597247097638126, 2.8959103896687286, 0.07796960020955525]
# 128 28 7
# [1.659713757010242, 2.8958876813163226, 0.07697878572747917]
# 256 28 7
# [1.6597140177475223, 2.8958907041642727, 0.07683641117892263]
# 512 28 7
# [1.6597142805289213, 2.8958935121939233, 0.07713688023194747]
# 1024 28 7
# [1.6597183211942244, 2.895898357408992, 0.0773147293360109]
# 2048 28 7
# [1.6597277968893651, 2.895912015774815, 0.07762931385069151]
# 128 64 7
# [1.6597138393068478, 2.89589089297933, 0.076835302745312]
# 256 64 7
# [1.6597241031603565, 2.8959175546830513, 0.07581607231333481]
# 512 64 7
# [1.6597221487393212, 2.895912399620589, 0.07745621376075788]
# 1024 64 7
# [1.6597210530083626, 2.895902235659768, 0.07724420597600704]
# 2048 64 7
# [1.6597194803056803, 2.8959063235384477, 0.0775677206684425]
# 256 128 7
# [1.6597138223643715, 2.8958894511386957, 0.07701905810685916]
# 512 128 7
# [1.6597248988159625, 2.895923690819992, 0.07798917219573431]
# 1024 128 7
# [1.6597189881280194, 2.895908073739844, 0.07709779689089916]
# 2048 128 7
# [1.659715417622847, 2.8958862331318715, 0.07705613859419341]
# 512 256 7
# [1.6597207448077982, 2.8959031486695777, 0.07688780890834628]
# 1024 256 7
# [1.6597181911716108, 2.895909567061513, 0.0767048563880592]
# 2048 256 7
# [1.6597181613364478, 2.8958975296626437, 0.07692698172024046]
# 128 28 9
# [1.6597188325763488, 2.895901340130698, 0.07692901679185339]
# 256 28 9
# [1.659717732135587, 2.895905779238962, 0.0773356304873858]
# 512 28 9
# [1.659719750725291, 2.8959118407111015, 0.07764822189756533]
# 1024 28 9
# [1.6597204956111384, 2.8959184064590087, 0.0769584667516603]
# 2048 28 9
# [1.6597270589624926, 2.895917893724818, 0.07785037204594787]
# 128 64 9
# [1.6597175569244922, 2.8958929024441904, 0.0764574478757722]
# 256 64 9
# [1.6597206696624043, 2.895901761155084, 0.07763896062743883]
# 512 64 9
# [1.6597134501745596, 2.8958878730790123, 0.07684996254850479]
# 1024 64 9
# [1.6597213740823897, 2.8959222104294566, 0.0777581575531549]
# 2048 64 9
# [1.659723554766226, 2.8959239151219767, 0.07731436318864453]
# 256 128 9
# [1.6597238348040881, 2.895927382741974, 0.07587712839236585]
# 512 128 9
# [1.659717519547236, 2.8958984619217727, 0.07708273151475983]
# 1024 128 9
# [1.6597173031013315, 2.895896810081577, 0.07685540026985885]
# 2048 128 9
# [1.6597175263331976, 2.895900362888141, 0.07753827472298205]
# 512 256 9
# [1.6597189876602432, 2.8959049037153433, 0.07759271658718511]
# 1024 256 9
# [1.6597178373724597, 2.89590425745342, 0.07743045496700157]
# 2048 256 9
# [1.6597156644934408, 2.895890030630345, 0.07705885394224218]


# rmsProp binary_crossentropy rmse mse mae
# 128 28 3
# [-0.6433916832383345, 1.658969569360668, 2.8935207452988583, 0.07105042969713216]
# 256 28 3
# [-0.6366177905050253, 1.659717761285105, 2.8958970440979317, 0.07596019275337686]
# 512 28 3
# [-0.6474816065700045, 1.658540929568805, 2.892767983711688, 0.06780977247399356]
# 1024 28 3
# [-0.6457686895652226, 1.6587281366547628, 2.893065571032045, 0.07013583112661548]
# 2048 28 3
# [-0.6428053307258366, 1.6589226553420677, 2.893400024912135, 0.07001999511981986]
# 128 64 3
# [-0.6449218765519924, 1.6587553210185049, 2.893063351477913, 0.07018652413147831]
# 256 64 3
# [-0.6508321092892383, 1.6582638679113462, 2.8918832309795794, 0.06696995672017843]  --best
# 512 64 3
# [-0.6431723978447222, 1.658824778283668, 2.8932335282479356, 0.07307650535805343]
# 1024 64 3
# [-0.6366817510275082, 1.6597153556520867, 2.8958920644836565, 0.07565976312292846]
# 2048 64 3
# [-0.6450641719458146, 1.6589837798179774, 2.8941603602476698, 0.07185820586941143]
# 256 128 3
# [-0.6489116033928606, 1.6584056293736584, 2.892304791385832, 0.06796751278622659]
# 512 128 3
# [-0.6453764735234627, 1.6587922272046656, 2.893235534431953, 0.06948472810561473]
# 1024 128 3
# [-0.6426440556620867, 1.6589707282991106, 2.893682413036861, 0.07203393921824365]
# 2048 128 3
# [-0.6472208873312555, 1.6585356778496425, 2.892608991090762, 0.06947399414664272]
# 512 256 3
# [-0.6497891439933888, 1.6583230898637684, 2.8920717394194644, 0.06748622366291714]
# 1024 256 3
# [-0.6454107250801919, 1.6588762695839896, 2.8938230835869527, 0.07146978696267703]
# 2048 256 3
# [-0.637040884758082, 1.659660329192546, 2.8957066990653995, 0.07414298676823212]
# 128 28 5
# [-0.6450594908321516, 1.6587030972508379, 2.892999455003951, 0.06898722058221116]
# 256 28 5
# [-0.6486291944713092, 1.6583570314753837, 2.8921684041167945, 0.06828472525546983]
# 512 28 5
# [-0.6468664984328587, 1.6585438934064423, 2.8927370433790456, 0.06936554906473634]
# 1024 28 5
# [-0.6490759109532493, 1.6583529384127165, 2.8921078450031237, 0.06806634808857355]
# 2048 28 5
# [-0.6452337230921439, 1.6586766070160006, 2.8929953651516396, 0.0696856531604384]
# 128 64 5
# [-0.6434797412264871, 1.6588963323469033, 2.8934292012279585, 0.07044841584755251]
# 256 64 5
# [-0.649564814880912, 1.6583560732514613, 2.892173920148843, 0.06860197835297516]
# 512 64 5
# [-0.6463569066616587, 1.6587016199489082, 2.8932321856271597, 0.06972553103811384]
# 1024 64 5
# [-0.6462761800912706, 1.658631014856594, 2.8927903865356224, 0.06914777614178877]
# 2048 64 5
# [-0.6384299239449857, 1.6593899076274015, 2.8951566996030884, 0.07623077522559088]
# 256 128 5
# [-0.6366771961157511, 1.6597160222398555, 2.895892923769668, 0.07517035822176679]
# 512 128 5
# [-0.6486330862940086, 1.6583882105854475, 2.8922803511714275, 0.06702619286529238]
# 1024 128 5
# [-0.644427060561893, 1.6588519088467168, 2.8934214769965694, 0.07122841640975669]
# 2048 128 5
# [-0.6460093022703237, 1.6586069906556007, 2.8929150710261093, 0.07032773991040023]
# 512 256 5
# [-0.6443808602739509, 1.6588384426921365, 2.893357367255019, 0.07024053075117358]
# 1024 256 5
# [-0.6483802959948901, 1.658415831801078, 2.8923469560835247, 0.06926811297750064]
# 2048 256 5
# [-0.6440431923919714, 1.6589996524834578, 2.894242787433554, 0.07186338884166392]
# 128 28 7
# [-0.6484903246825137, 1.6584303377328706, 2.892376538557415, 0.06875403343587509]
# 256 28 7
# [-0.6494565340061415, 1.6583287599608556, 2.892082534980943, 0.06797322722334952]
# 512 28 7
# [-0.6493956710925287, 1.6583209624423623, 2.8920534755323235, 0.06766542950915673]
# 1024 28 7
# [-0.6493296795874713, 1.6583360098349422, 2.892096843812269, 0.06850994039630981]
# 2048 28 7
# [-0.6489786463871617, 1.658387739797343, 2.892256431854873, 0.06903052093886129]
# 128 64 7
# [-0.6366506552345075, 1.6597154538979453, 2.8958928937038206, 0.07545676677846408]
# 256 64 7
# [-0.6477806479027941, 1.6584038495613758, 2.892289017286605, 0.06867615160577276]
# 512 64 7
# [-0.6458574296274261, 1.6586358438853175, 2.8928223392773544, 0.06914576036835504]
# 1024 64 7
# [-0.6488902410510073, 1.6583452260551583, 2.8921225179310888, 0.0683331758202005]
# 2048 64 7
# [-0.6490736114862486, 1.6584131245932596, 2.892370737630319, 0.06895367590309577]
# 256 128 7
# [-0.6421497009972319, 1.6589600758836165, 2.893997698952607, 0.06810439146117393]
# 512 128 7
# [-0.6459330125446106, 1.658819257368803, 2.893656911841517, 0.07120462382636254]
# 1024 128 7
# [-0.6455702821181923, 1.65871004410194, 2.893311310004127, 0.06913395452420733]
# 2048 128 7
# [-0.6428870179134961, 1.6589913466394062, 2.8941728023307904, 0.07239421742964532]
# 512 256 7
# [-0.645955217824331, 1.6585861266750277, 2.8927437267374723, 0.06864660684715485]
# 1024 256 7
# [-0.639934341094083, 1.6591938755424898, 2.8947698338771817, 0.07223511436082516]
# 2048 256 7
# [-0.6439802079442066, 1.6588220746001923, 2.893202151409431, 0.07174292866036576]
# 128 28 9
# [-0.6484692286255763, 1.6583866442009503, 2.892258999485905, 0.06816741528505793]
# 256 28 9
# [-0.6487692147449308, 1.6583548918341202, 2.8921619232991382, 0.0686022509612828]
# 512 28 9
# [-0.6447065195012798, 1.6587470696351598, 2.8931581266533763, 0.0687946501311207]
# 1024 28 9
# [-0.647933727839718, 1.658475319995163, 2.892582524635626, 0.06791049143017663]
# 2048 28 9
# [-0.6469339882929874, 1.6585017570765044, 2.892543769130737, 0.06905156948926112]
# 128 64 9
# [-0.6469760510586794, 1.658543674480682, 2.8928021903666896, 0.06972395190630942]
# 256 64 9
# [-0.6494134899192666, 1.6583211651625538, 2.8920579048236914, 0.06736017330701219]
# 512 64 9
# [-0.6485793340381402, 1.6584298444722754, 2.892407440071025, 0.06902613264160641]
# 1024 64 9
# [-0.6450447259476778, 1.658997595324629, 2.8942505310936832, 0.07161279001006912]
# 2048 64 9
# [-0.646618907298545, 1.6585599237638304, 2.892592573459375, 0.06923840298948726]
# 256 128 9
# [-0.643894873109921, 1.6588429821160093, 2.893781035307911, 0.06719973043789164]
# 512 128 9
# [-0.6490644080113374, 1.6583927437423984, 2.892278704508812, 0.06822191344542905]
# 1024 128 9
# [-0.6451839833917417, 1.658798220881267, 2.893564257397617, 0.07142679820938419]
# 2048 128 9
# [-0.6463860278695779, 1.658791751681126, 2.8935542606828766, 0.07019589257145939]
# 512 256 9
# [-0.6464738191434857, 1.6586246375713103, 2.892891028165324, 0.06839554922964455]
# 1024 256 9
# [-0.6425803470227739, 1.6590624757950707, 2.8939474643559944, 0.07255566221272311]
# 2048 256 9
# [-0.6459718991230082, 1.6586228159282836, 2.8927760323492104, 0.06916206449367969]


# adam
# 128 28 3
# [-0.6366715360870703, 1.659719094537537, 2.8959044858051946, 0.07585022745285884]
# 256 28 3
# [-0.6365858415615736, 1.6597179692982185, 2.8959074331937638, 0.0762146779385321]
# 512 28 3
# [-0.6480329511649864, 1.6585526468356078, 2.892573138478013, 0.06905611776203766]
# 1024 28 3
# [-0.6501825405698022, 1.6583206173579497, 2.8920257132212357, 0.06731204716483463]
# 2048 28 3
# [-0.6502925193190917, 1.6582936670554176, 2.891975647306072, 0.06722420602107736]
# 128 64 3
# [-0.649830112279264, 1.6583559882443155, 2.892146707571136, 0.06850341746956691]
# 256 64 3
# [-0.6502743655260086, 1.6583067885292826, 2.8919939537031936, 0.06832228446348315]
# 512 64 3
# [-0.6497683890447649, 1.658341993970187, 2.892108992336867, 0.06749499227759416]
# 1024 64 3
# [-0.6366086875603872, 1.6597234470559052, 2.895913485605138, 0.07631522724407183]
# 2048 64 3
# [-0.6365097465141428, 1.6597268875064246, 2.8959381381643934, 0.0759790611642112]
# 256 128 3
# [-0.6366025908384134, 1.6597263461545715, 2.895919779978658, 0.07581534519337844]
# 512 128 3
# [-0.6505940566314244, 1.6582767182735478, 2.8919245619843967, 0.0674523734433151]
# 1024 128 3
# [-0.6504605139859289, 1.6582750861055924, 2.8919123286064425, 0.0675743509292343]
# 2048 128 3
# [-0.6504321504123658, 1.6582748471743816, 2.8919187794607777, 0.06774478111751815]
# 512 256 3
# [-0.6501488625886321, 1.658305268916017, 2.8920042717867243, 0.06744763684147972]
# 1024 256 3
# [-0.6363271550980079, 1.6597261394038134, 2.8959403723028965, 0.0770107759229616]
# 2048 256 3
# [-0.6364112154626935, 1.6597236549729004, 2.8959333708693378, 0.07673579069828101]
# 128 28 5
# [-0.6366293542530624, 1.6597225069278807, 2.8959236897562812, 0.07560194092808585]
# 256 28 5
# [-0.6445390211532062, 1.658906291223019, 2.8938228215040143, 0.07024879493288888]
# 512 28 5
# [-0.6507991718285367, 1.658272913611047, 2.891914632808878, 0.06761139852283693]
# 1024 28 5
# [-0.6502344907956112, 1.6583133268706194, 2.8920461416058676, 0.06706939315323797]
# 2048 28 5
# [-0.6366229443195497, 1.6597194057946678, 2.8959091370788888, 0.07552495836726211]
# 128 64 5
# [-0.6498232930558246, 1.6583412978612422, 2.892118808464288, 0.06723911637079329]
# 256 64 5
# [-0.6366903609870906, 1.6597182753072826, 2.8959014227412907, 0.07545651709340243]
# 512 64 5
# [-0.6364964548481672, 1.6597483100312351, 2.895966567755303, 0.07639609147868962]
# 1024 64 5
# [-0.6494504819439975, 1.658365261988212, 2.8922108544784817, 0.06787930329479173]
# 2048 64 5
# [-0.650234044339889, 1.6582913708115885, 2.8919632182309796, 0.06774203403056073]
# 256 128 5
# [-0.6507268692718087, 1.658259516501544, 2.8918711597598366, 0.06725542745329056]
# 512 128 5
# [-0.6502449834254177, 1.6583061481882553, 2.892008752879522, 0.06796975243792287]
# 1024 128 5
# [-0.6503152641916978, 1.658288381592276, 2.8919632064532674, 0.06743156879505122]
# 2048 128 5
# [-0.6503103303073712, 1.6582966726340882, 2.891982795326655, 0.06782241236545342]
# 512 256 5
# [-0.6502291299595951, 1.6582759549521842, 2.891922290180282, 0.06741833313528633]
# 1024 256 5
# [-0.6504920788705437, 1.6582966892369462, 2.8919893251647135, 0.06739982212343862]
# 2048 256 5
# [-0.6501005954563267, 1.6583321845390169, 2.8920620132717163, 0.06816144456894833]
# 128 28 7
# [-0.6366204732266718, 1.659715668415073, 2.895899084589823, 0.07585660538754269]
# 256 28 7
# [-0.6493499961975752, 1.658408572180582, 2.892350452603132, 0.06734855808895374]
# 512 28 7
# [-0.6366069283591015, 1.6597215336454032, 2.895926946133586, 0.07569940807899818]
# 1024 28 7
# [-0.6502123872075952, 1.6582974128485797, 2.8919736449027127, 0.06779930972120149]
# 2048 28 7
# [-0.6362491391716724, 1.6597219818584907, 2.895933675564783, 0.07694746315504108]
# 128 64 7
# [-0.6492059991677991, 1.6584344123536137, 2.892417254173551, 0.06737799235121816]
# 256 64 7
# [-0.6362819720346887, 1.6597217054923528, 2.895937242238034, 0.07710065997298564]
# 512 64 7
# [-0.6502767183002944, 1.6582904843753228, 2.8919654490630085, 0.06775988413383766]
# 1024 64 7
# [-0.6488537026508322, 1.6584415979436895, 2.8924743096676657, 0.06865863565343625]
# 2048 64 7
# [-0.6500666264028977, 1.6582879565629551, 2.8919443491565278, 0.06740713387597176]
# 256 128 7
# [-0.6366713705807335, 1.6597224029021003, 2.895905559114926, 0.07564866400941345]
# 512 128 7
# [-0.6507294453868947, 1.658271860473372, 2.891912117748223, 0.06734579625342314]
# 1024 128 7
# [-0.6500880171173117, 1.6583209342219891, 2.892037550860361, 0.06735839635825797]
# 2048 128 7
# [-0.6504215936090848, 1.6582716651991554, 2.891913847675037, 0.06729878726920634]
# 512 256 7
# [-0.6503547799101211, 1.6582989710886413, 2.891968800495039, 0.06722510400637381]
# 1024 256 7
# [-0.6467320896256795, 1.6585404777608876, 2.892876313906431, 0.06951071429576865]
# 2048 256 7
# [-0.6499523552076611, 1.6583088067152891, 2.8920143870988, 0.0675069682085226]
# 128 28 9
# [-0.6366528710576422, 1.6597234111716888, 2.8959079384179, 0.07593243291193186]
# 256 28 9
# [-0.6501109209137436, 1.6583154285515083, 2.8920496397787123, 0.06772047149743197]
# 512 28 9
# [-0.6365584905396755, 1.659721519387835, 2.8959236270486133, 0.07575868485237079]
# 1024 28 9
# [-0.6362890226600613, 1.6597226764423563, 2.895938853951986, 0.07684910878089331]
# 2048 28 9
# [-0.650430481919651, 1.6582972113074408, 2.8919652923515087, 0.06750813990588676]
# 128 64 9
# [-0.6500383697418722, 1.658297354831491, 2.8919784665110932, 0.06766919237876036]
# 256 64 9
# [-0.6497065206089486, 1.6583794434754247, 2.8922314063304504, 0.06824289488313269]
# 512 64 9
# [-0.6507420139138193, 1.6582398825037543, 2.891812280104392, 0.06724077831664108]
# 1024 64 9
# [-0.6501540528752975, 1.658318673830337, 2.892043440126708, 0.06782313653357255]
# 2048 64 9
# [-0.6492061578208912, 1.6584080389411249, 2.892266213251499, 0.06871047076400043]
# 256 128 9
# [-0.6365527799286672, 1.659729358679401, 2.8959285788269886, 0.07647053820926622]
# 512 128 9
# [-0.6365569687365115, 1.6597296067226397, 2.8959462676054817, 0.07500419074378972]
# 1024 128 9
# [-0.6504580159862965, 1.658301429208734, 2.891985858736585, 0.06768874858609676]
# 2048 128 9
# [-0.6503797578559174, 1.6582949471030908, 2.89196448555898, 0.06771195343468477]
# 512 256 9
# [-0.6508090756752454, 1.6582526080209221, 2.891858381518502, 0.06696930100040127] --best2
# 1024 256 9
# [-0.6503053861207501, 1.6582911849569786, 2.8919305022575945, 0.06725135948854905]


# adadelta
# 128 28 3
# [-0.636627370754598, 1.6597258221745237, 2.8959222369453292, 0.07541950749001129]
# 256 28 3
# [-0.6364060741211383, 1.6597311330193407, 2.89595475160826, 0.07627629101329263]
# 512 28 3
# [-0.636508491095217, 1.659732082144051, 2.8959402701354056, 0.07613408130605337]
# 1024 28 3
# [-0.6364984341606738, 1.6597447294784822, 2.895963074888196, 0.076256913315916]
# 2048 28 3
# [-0.6365337386644431, 1.6597368040647964, 2.8959505497202986, 0.07596054051869289]
# 128 64 3
# [-0.6364715555929332, 1.6597311195114963, 2.8959581439482975, 0.0758185186106596]
# 256 64 3
# [-0.6366059738773902, 1.6597323538003856, 2.8959411313437857, 0.07572705905710189]
# 512 64 3
# [-0.6365720011570429, 1.6597262452430284, 2.895923310075639, 0.07572854396520397]
# 1024 64 3
# [-0.636471455857239, 1.6597405630838555, 2.895966268878227, 0.07642115152505019]
# 2048 64 3
# [-0.6364416757157826, 1.659759822335083, 2.896001619291366, 0.07624494233048137]
# 256 128 3
# [-0.6365402686002225, 1.6597337629094884, 2.8959553080571157, 0.07537185634031893]
# 512 128 3
# [-0.6364206253375305, 1.65973758855144, 2.8959805761203943, 0.0755755782616383]
# 1024 128 3
# [-0.6363549850204065, 1.659743344328502, 2.896008515686696, 0.07569794705092105]
# 2048 128 3
# [-0.636572877795636, 1.659738827236146, 2.8959489638301665, 0.07573917266507584]
# 512 256 3
# [-0.636391545415684, 1.659735319919234, 2.895983465466243, 0.07601659597836644]
# 1024 256 3
# [-0.6429419720823604, 1.6589732398930939, 2.8939764687864207, 0.0718254230694827]
# 2048 256 3
# [-0.6460254692520602, 1.6586545414524385, 2.8929290680364095, 0.07008245665385095]
# 128 28 5
# [-0.6364836051780183, 1.6597286273975165, 2.895944613061154, 0.07592889679973844]
# 256 28 5
# [-0.6365378954440222, 1.6597307425285786, 2.8959378336227375, 0.07615364734910934]
# 512 28 5
# [-0.6366095766687456, 1.659724059900652, 2.8959177078445766, 0.07567492189535058]
# 1024 28 5
# [-0.6365384769910036, 1.6597297982226058, 2.8959410493996143, 0.07562099687560268]
# 2048 28 5
# [-0.636503955311029, 1.659731691031723, 2.8959610324995673, 0.0756204404227421]
# 128 64 5
# [-0.6365570426628033, 1.6597323706595597, 2.8959507961167077, 0.07535051526186637]
# 256 64 5
# [-0.6366117572468515, 1.6597280878398741, 2.895927139152223, 0.07561672955060968]
# 512 64 5
# [-0.6364994310610533, 1.6597326281352207, 2.8959605976341263, 0.07571825611392534]
# 1024 64 5
# [-0.6365050535699023, 1.65974546720671, 2.895973068014515, 0.07614678616016013]
# 2048 64 5
# [-0.6364475289168904, 1.6597299027802415, 2.895958688055546, 0.07620269087068075]
# 256 128 5
# [-0.6364335715153961, 1.6597351492192978, 2.8959708098592185, 0.07582282124796438]
# 512 128 5
# [-0.6362338786348563, 1.6597486844702185, 2.8960333219970034, 0.07627156140527502]
# 1024 128 5
# [-0.6363324002634948, 1.6597531090005198, 2.8960423089170764, 0.07537767235400436]
# 2048 128 5
# [-0.6452418685417576, 1.6587656150852423, 2.8932770932759135, 0.06921866405479442]
# 512 256 5
# [-0.6462241736185542, 1.6586560437772013, 2.892882686597253, 0.07011199101385569]
# 1024 256 5
# [-0.6466008715180769, 1.6586429520423807, 2.892842746836325, 0.06906164144030773]
# 2048 256 5
# [-0.645274827656341, 1.6588175027395509, 2.8934679597701902, 0.07065539331034638]
# 128 28 7
# [-0.6365433798034436, 1.6597296021345862, 2.895936725056764, 0.07587474920092888]
# 256 28 7
# [-0.6365058994602073, 1.659734431964297, 2.8959473967408007, 0.07611995249094348]
# 512 28 7
# [-0.6363776287892327, 1.6597376809981528, 2.8959923373261387, 0.07606184432092258]
# 1024 28 7
# [-0.6365511652782968, 1.6597321730785004, 2.8959513854124372, 0.07575193875543784]
# 2048 28 7
# [-0.6365749356385076, 1.6597297358673717, 2.8959424372473186, 0.07571596921661308]
# 128 64 7
# [-0.6366316073268975, 1.6597245715134608, 2.895913767667895, 0.07600037327957547]
# 256 64 7
# [-0.6364943358819795, 1.6597390699416072, 2.8959576042496815, 0.0760602844668722]
# 512 64 7
# [-0.6366149475363225, 1.659722091869246, 2.8959153448048416, 0.07572397597793526]
# 1024 64 7
# [-0.6364947935274897, 1.6597436830947294, 2.8959603128287896, 0.07581180045916097]
# 2048 64 7
# [-0.645138952256428, 1.6587771154191406, 2.8932938742093604, 0.06895516745558504]
# 256 128 7
# [-0.6364887121235907, 1.6597359935236486, 2.895958119880241, 0.07584388486532971]
# 512 128 7
# [-0.6365759775223157, 1.6597324425689663, 2.8959310311543436, 0.07602334363742425]
# 1024 128 7
# [-0.6465682201523012, 1.6586354358561444, 2.892817485206574, 0.06998069481663105]
# 2048 128 7
# [-0.6420982472183441, 1.6590847099183321, 2.8943494456032295, 0.07231121081178535]
# 512 256 7
# [-0.6466176279204968, 1.658634118488886, 2.892840246782962, 0.06922783686331863]
# 1024 256 7
# [-0.6464215823037112, 1.658619929292975, 2.8928072864636944, 0.06979698601004886]
# 2048 256 7
# [-0.6468923482818131, 1.6586022400595217, 2.8927327558687805, 0.06947798200507734]
# 128 28 9
# [-0.6365423909978385, 1.6597315925167329, 2.895951863095438, 0.07563812074741802]
# 256 28 9
# [-0.6363669309049118, 1.6597506363280956, 2.8960306218250547, 0.07570275628925904]
# 512 28 9
# [-0.6365086939980337, 1.659727964116222, 2.8959470144841846, 0.07591917495048686]
# 1024 28 9
# [-0.6365713053412595, 1.6597257862646757, 2.8959345876134086, 0.07583357615334654]
# 2048 28 9
# [-0.636528737775954, 1.6597371664056726, 2.895957820311112, 0.0757119218144087]
# 128 64 9
# [-0.6365642221894078, 1.6597352957037959, 2.895935134373526, 0.07553317975204307]
# 256 64 9
# [-0.6365381047018694, 1.6597299787907016, 2.8959514514009483, 0.07565160265280649]
# 512 64 9
# [-0.636397861981349, 1.6597428096536762, 2.8959998227608827, 0.07580388476304924]
# 1024 64 9
# [-0.636494588663857, 1.6597299045103733, 2.8959430269531534, 0.07621815331088194]
# 2048 64 9
# [-0.6364219259801809, 1.659734781873855, 2.8959696887465847, 0.07584289633566457]
# 256 128 9
# [-0.6365503465414503, 1.6597268297712833, 2.8959330553701803, 0.07609274042466642]
# 512 128 9
# [-0.6365486545942348, 1.6597308431133189, 2.895937602067015, 0.07593949125441342]
# 1024 128 9
# [-0.6365017594388778, 1.6597477900689384, 2.895977975629673, 0.07588236257491963]
# 2048 128 9
# [-0.6455550925520263, 1.6587470680972647, 2.893187605280908, 0.06934311837806978]
# 512 256 9
# [-0.6365378582894403, 1.659734198761745, 2.8959432700943517, 0.0760355876586933]
# 1024 256 9
# [-0.6466145864143564, 1.6586259246420372, 2.8928092274281485, 0.06976193688916203]
# 2048 256 9
# [-0.645507304839261, 1.658720340584454, 2.8931250215156634, 0.07067005324890598]